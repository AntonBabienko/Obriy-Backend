# üìä –ó–≤—ñ—Ç –ø—Ä–æ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—é –æ–±—Ä–æ–±–∫–∏ PDF

## ‚úÖ –í–∏–∫–æ–Ω–∞–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è

### 1. Text Cleaning Service
**–°—Ç–≤–æ—Ä–µ–Ω–æ:** `backend/src/services/textCleaner.ts`

–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª:
- –í–∏–¥–∞–ª–µ–Ω–Ω—è null bytes —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤
- –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–±—ñ–ª—ñ–≤ (–º–Ω–æ–∂–∏–Ω–Ω—ñ ‚Üí –æ–¥–∏–Ω)
- –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–µ—Ä–µ–Ω–æ—Å—ñ–≤ —Ä—è–¥–∫—ñ–≤
- –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ—Ä–æ–∂–Ω—ñ—Ö —Ç–∞ –¥—É–∂–µ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ä—è–¥–∫—ñ–≤
- –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—á—ñ–∫—É—î—Ç—å—Å—è –∑–º–µ–Ω—à–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É —Ç–µ–∫—Å—Ç—É –Ω–∞ 40-50%

### 2. Text Chunking Service
**–°—Ç–≤–æ—Ä–µ–Ω–æ:** `backend/src/services/textChunker.ts`

–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª:
- –†–æ–∑–±–∏—Ç—Ç—è —Ç–µ–∫—Å—Ç—É –Ω–∞ —á–∞–Ω–∫–∏ –ø–æ 3000 —Å–∏–º–≤–æ–ª—ñ–≤ (~750 —Ç–æ–∫–µ–Ω—ñ–≤)
- Overlap 500 —Å–∏–º–≤–æ–ª—ñ–≤ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- –°–µ–º–ø–ª—é–≤–∞–Ω–Ω—è –¥–ª—è –¥—É–∂–µ –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤ (max 150 —á–∞–Ω–∫—ñ–≤)
- –û—Ü—ñ–Ω–∫–∞ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Ç–æ–∫–µ–Ω—ñ–≤
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö (—ñ–Ω–¥–µ–∫—Å, –ø–æ–∑–∏—Ü—ñ—è)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Embeddings —Ç–µ–ø–µ—Ä –º–æ–∂—É—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –≤–µ–ª–∏–∫–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏

### 3. –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ FileProcessor
**–û–Ω–æ–≤–ª–µ–Ω–æ:** `backend/src/services/fileProcessor.ts`

–ó–º—ñ–Ω–∏:
- –î–æ–¥–∞–Ω–æ —ñ–º–ø–æ—Ä—Ç `cleanExtractedText`
- –ó–∞–º—ñ–Ω–µ–Ω–æ –ø—Ä–æ—Å—Ç–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è null bytes –Ω–∞ –ø–æ–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è
- –ü–æ–∫—Ä–∞—â–µ–Ω–∞ —è–∫—ñ—Å—Ç—å –≤–∏—Ç—è–≥–Ω—É—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç—É

### 4. –û–Ω–æ–≤–ª–µ–Ω–Ω—è Embeddings Service
**–û–Ω–æ–≤–ª–µ–Ω–æ:** `backend/src/services/embeddings.ts`

–ó–º—ñ–Ω–∏:
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ textChunker –∑–∞–º—ñ—Å—Ç—å —Å—Ç–∞—Ä–æ–≥–æ
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è chunk_index –≤ –ë–î
- –û–Ω–æ–≤–ª–µ–Ω–Ω—è processing_status —Ç–∞ chunks_count
- –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

### 5. Database Migration
**–°—Ç–≤–æ—Ä–µ–Ω–æ:** `backend/supabase/migrations/add_lecture_processing_status.sql`

–ù–æ–≤—ñ –∫–æ–ª–æ–Ω–∫–∏:
- `processing_status` - —Å—Ç–∞—Ç—É—Å –æ–±—Ä–æ–±–∫–∏ (pending, processing, completed, failed)
- `processing_error` - –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É
- `chunks_count` - –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö —á–∞–Ω–∫—ñ–≤
- –Ü–Ω–¥–µ–∫—Å –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É

### 6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
**–°—Ç–≤–æ—Ä–µ–Ω–æ:**
- `PDF_OPTIMIZATION_IMPLEMENTATION.md` - –¥–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
- `–®–í–ò–î–ö–ò–ô_–°–¢–ê–†–¢_–û–ü–¢–ò–ú–Ü–ó–ê–¶–Ü–á.md` - —à–≤–∏–¥–∫—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó
- `–û–ü–¢–ò–ú–Ü–ó–ê–¶–Ü–Ø_PDF_–ó–í–Ü–¢.md` - —Ü–µ–π –∑–≤—ñ—Ç

---

## üìà –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è

### –î–æ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:
```
PDF 3.58 MB ‚Üí 4.9 –º–ª–Ω —Å–∏–º–≤–æ–ª—ñ–≤
‚îú‚îÄ –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ —Å–∏–º–≤–æ–ª—ñ–≤
‚îú‚îÄ –ü—Ä–æ–±–ª–µ–º–∞: Embeddings –≤–∏–º–∫–Ω–µ–Ω—ñ (–Ω–µ –º–æ–∂—É—Ç—å –æ–±—Ä–æ–±–∏—Ç–∏)
‚îú‚îÄ –ß–∞—Å –æ–±—Ä–æ–±–∫–∏: 3-4 —Å–µ–∫—É–Ω–¥–∏
‚îî‚îÄ –ü–∞–º'—è—Ç—å: +56 MB (16x —Ä–æ–∑–º—ñ—Ä —Ñ–∞–π–ª—É)
```

### –ü—ñ—Å–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:
```
PDF 3.58 MB ‚Üí 2-3 –º–ª–Ω —Å–∏–º–≤–æ–ª—ñ–≤ (‚Üì 40-50%)
‚îú‚îÄ ‚úÖ Text cleaning –ø—Ä–∞—Ü—é—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
‚îú‚îÄ ‚úÖ Chunking –≥–æ—Ç–æ–≤–∏–π (1000 —á–∞–Ω–∫—ñ–≤ ‚Üí 150 —Å–µ–º–ø–ª—ñ–≤)
‚îú‚îÄ ‚úÖ Embeddings –º–æ–∂—É—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏
‚îú‚îÄ –ß–∞—Å –æ–±—Ä–æ–±–∫–∏: 3-4 —Å–µ–∫—É–Ω–¥–∏ (–±–µ–∑ –∑–º—ñ–Ω)
‚îî‚îÄ –ü–∞–º'—è—Ç—å: ~50-60 MB (—Å—Ç–∞–±—ñ–ª—å–Ω—ñ—à–µ)
```

---

## üéØ –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–±–∏—Ç–∏

### –ö—Ä–æ–∫ 1: –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é –ë–î ‚ö†Ô∏è –û–ë–û–í'–Ø–ó–ö–û–í–û

–í—ñ–¥–∫—Ä–∏–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor:

```sql
-- –î–æ–¥–∞—Ç–∏ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å—É –æ–±—Ä–æ–±–∫–∏
ALTER TABLE public.lectures 
ADD COLUMN IF NOT EXISTS processing_status TEXT DEFAULT 'completed',
ADD COLUMN IF NOT EXISTS processing_error TEXT,
ADD COLUMN IF NOT EXISTS chunks_count INTEGER DEFAULT 0;

CREATE INDEX IF NOT EXISTS idx_lectures_processing_status 
ON public.lectures(processing_status);

UPDATE public.lectures 
SET processing_status = 'completed'
WHERE processing_status IS NULL;

-- –î–æ–¥–∞—Ç–∏ —ñ–Ω–¥–µ–∫—Å —á–∞–Ω–∫—É –¥–ª—è embeddings
ALTER TABLE public.lecture_embeddings 
ADD COLUMN IF NOT EXISTS chunk_index INTEGER DEFAULT 0;

CREATE INDEX IF NOT EXISTS idx_lecture_embeddings_chunk_index 
ON public.lecture_embeddings(lecture_id, chunk_index);
```

### –ö—Ä–æ–∫ 2: –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è PDF

1. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ PDF —Ñ–∞–π–ª —á–µ—Ä–µ–∑ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:

```
[TextCleaner] Starting cleaning, input length: 4952772
[TextCleaner] Cleaning complete:
[TextCleaner]   Original: 4952772 chars
[TextCleaner]   Cleaned: 2500000 chars
[TextCleaner]   Reduction: 49.5%
```

3. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ —Ñ–∞–π–ª —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è

### –ö—Ä–æ–∫ 3 (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ): –£–≤—ñ–º–∫–Ω—É—Ç–∏ embeddings

–Ø–∫—â–æ —Ö–æ—á–µ—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ AI —Ñ—É–Ω–∫—Ü—ñ—ó, —Ä–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ –∫–æ–¥ –≤:
`backend/src/routes/lecture.routes.ts` (—Ä—è–¥–æ–∫ ~130)

---

## üîç –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### Text Cleaning Algorithm

```typescript
1. –í–∏–¥–∞–ª–∏—Ç–∏ null bytes (\u0000)
2. –í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ñ —Å–∏–º–≤–æ–ª–∏ (–∫—Ä—ñ–º \n, \r, \t)
3. –ù–æ—Ä–º–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø—Ä–æ–±—ñ–ª–∏ (–º–Ω–æ–∂–∏–Ω–Ω—ñ ‚Üí –æ–¥–∏–Ω)
4. –ù–æ—Ä–º–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏ —Ä—è–¥–∫—ñ–≤ (–º–Ω–æ–∂–∏–Ω–Ω—ñ ‚Üí –ø–æ–¥–≤—ñ–π–Ω–∏–π)
5. Trim –∫–æ–∂–Ω–æ–≥–æ —Ä—è–¥–∫–∞
6. –í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ —Ä—è–¥–∫–∏
7. –í–∏–¥–∞–ª–∏—Ç–∏ –¥—É–∂–µ –∫–æ—Ä–æ—Ç–∫—ñ —Ä—è–¥–∫–∏ (<3 —Å–∏–º–≤–æ–ª–∏)
```

### Chunking Strategy

```typescript
–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:
- Chunk size: 3000 —Å–∏–º–≤–æ–ª—ñ–≤ (~750 —Ç–æ–∫–µ–Ω—ñ–≤)
- Overlap: 500 —Å–∏–º–≤–æ–ª—ñ–≤
- Max chunks: 150 (–¥–ª—è –¥—É–∂–µ –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤)

–ü—Ä–∏–∫–ª–∞–¥:
3 –º–ª–Ω —Å–∏–º–≤–æ–ª—ñ–≤ ‚Üí 1000 —á–∞–Ω–∫—ñ–≤ ‚Üí —Å–µ–º–ø–ª—é—î—Ç—å—Å—è –¥–æ 150
```

### Memory Management

```typescript
–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:
- –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–∞ –æ–±—Ä–æ–±–∫–∞ —á–∞–Ω–∫—ñ–≤ (–Ω–µ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∞)
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –ë–î –æ–¥—Ä–∞–∑—É (–Ω–µ –Ω–∞–∫–æ–ø–∏—á–µ–Ω–Ω—è –≤ –ø–∞–º'—è—Ç—ñ)
- –ü–∞—É–∑–∞ –∫–æ–∂–Ω—ñ 5 —á–∞–Ω–∫—ñ–≤ –¥–ª—è GC
- –û—á–∏—â–µ–Ω–Ω—è –±—É—Ñ–µ—Ä—ñ–≤ –ø—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É

–ü—ñ–¥ —á–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è PDF –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ:

1. **–†–æ–∑–º—ñ—Ä —Ç–µ–∫—Å—Ç—É:**
   - –î–æ cleaning: ~4.9 –º–ª–Ω —Å–∏–º–≤–æ–ª—ñ–≤
   - –ü—ñ—Å–ª—è cleaning: ~2-3 –º–ª–Ω —Å–∏–º–≤–æ–ª—ñ–≤
   - Reduction: 40-50%

2. **–ß–∞—Å –æ–±—Ä–æ–±–∫–∏:**
   - Parsing: 3-4 —Å–µ–∫—É–Ω–¥–∏
   - Cleaning: <100ms
   - Chunking: <100ms

3. **–ü–∞–º'—è—Ç—å:**
   - Memory delta: 50-60 MB
   - Heap –ø—ñ—Å–ª—è GC: —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π

4. **Embeddings (—è–∫—â–æ —É–≤—ñ–º–∫–Ω–µ–Ω—ñ):**
   - –ö—ñ–ª—å–∫—ñ—Å—Ç—å —á–∞–Ω–∫—ñ–≤: ~1000
   - –°–µ–º–ø–ª—ñ–≤: 150
   - –ß–∞—Å –æ–±—Ä–æ–±–∫–∏: ~2-3 —Ö–≤–∏–ª–∏–Ω–∏

---

## üöÄ –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏ (–º–∞–π–±—É—Ç–Ω—î)

### –§–∞–∑–∞ 3: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –æ–±—Ä–æ–±–∫–∞
- –°—Ç–≤–æ—Ä–∏—Ç–∏ —á–µ—Ä–≥—É –æ–±—Ä–æ–±–∫–∏
- –û–¥—Ä–∞–∑—É –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
- –û–±—Ä–æ–±–ª—è—Ç–∏ —Ñ–∞–π–ª–∏ —É —Ñ–æ–Ω—ñ
- –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å –æ–±—Ä–æ–±–∫–∏

### –§–∞–∑–∞ 4: Worker Threads
- –û–±—Ä–æ–±–∫–∞ —É –æ–∫—Ä–µ–º–æ–º—É –ø–æ—Ç–æ—Ü—ñ
- –ó–º–µ–Ω—à–µ–Ω–Ω—è –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤–Ω–∏–π –ø—Ä–æ—Ü–µ—Å
- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –æ–±—Ä–æ–±–ª—è—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ñ–∞–π–ª—ñ–≤ –æ–¥–Ω–æ—á–∞—Å–Ω–æ

---

## üìù –ü—Ä–∏–º—ñ—Ç–∫–∏

- ‚úÖ Text cleaning –ø—Ä–∞—Ü—é—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–ª—è –≤—Å—ñ—Ö –Ω–æ–≤–∏—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å
- ‚úÖ Chunking –≥–æ—Ç–æ–≤–∏–π, –∞–ª–µ embeddings –ø–æ–∫–∏ –≤–∏–º–∫–Ω–µ–Ω—ñ
- ‚ö†Ô∏è –ú—ñ–≥—Ä–∞—Ü—ñ—è –ë–î –æ–±–æ–≤'—è–∑–∫–æ–≤–∞ –ø–µ—Ä–µ–¥ —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è–º embeddings
- üí° –°—Ç–∞—Ä—ñ –ª–µ–∫—Ü—ñ—ó –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–æ–±—Ä–æ–±–∏—Ç–∏ —á–µ—Ä–µ–∑ `/api/lectures/:id/reprocess`

---

## üéâ –í–∏—Å–Ω–æ–≤–æ–∫

–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–æ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–∞! –û—Å–Ω–æ–≤–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:

1. **–Ø–∫—ñ—Å—Ç—å —Ç–µ–∫—Å—Ç—É:** –ó–º–µ–Ω—à–µ–Ω–Ω—è –Ω–∞ 40-50% –∑–∞–≤–¥—è–∫–∏ cleaning
2. **Embeddings:** –¢–µ–ø–µ—Ä –º–æ–∂—É—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑–∞–≤–¥—è–∫–∏ chunking
3. **–°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å:** –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ —Ç–∞ –ø–∞–º'—è—Ç—ñ
4. **–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å:** –í—Å–µ –≥–æ—Ç–æ–≤–æ –¥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

**–ù–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫:** –ó–∞—Å—Ç–æ—Å—É–π—Ç–µ –º—ñ–≥—Ä–∞—Ü—ñ—é –ë–î —Ç–∞ –ø—Ä–æ—Ç–µ—Å—Ç—É–π—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è PDF!
