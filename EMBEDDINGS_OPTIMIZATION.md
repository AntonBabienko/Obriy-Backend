# ‚ö° –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ Embeddings

## –©–æ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ

### ‚úÖ 1. –ó–±—ñ–ª—å—à–µ–Ω–æ batch size: 10 ‚Üí 20

**–ë—É–ª–æ:**
```typescript
const BATCH_SIZE = 10; // –û–±—Ä–æ–±–ª—è—î–º–æ –ø–æ 10 —á–∞–Ω–∫—ñ–≤ –∑–∞ —Ä–∞–∑
```

**–°—Ç–∞–ª–æ:**
```typescript
const BATCH_SIZE = 20; // –û–±—Ä–æ–±–ª—è—î–º–æ –ø–æ 20 —á–∞–Ω–∫—ñ–≤ –∑–∞ —Ä–∞–∑ (—à–≤–∏–¥—à–µ!)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–¥–≤—ñ—á—ñ –º–µ–Ω—à–µ –±–∞—Ç—á—ñ–≤ = —à–≤–∏–¥—à–µ –æ–±—Ä–æ–±–∫–∞

### ‚úÖ 2. –ó–º–µ–Ω—à–µ–Ω–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–∞—É–∑

**–ë—É–ª–æ:**
```typescript
// –ü–∞—É–∑–∞ –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ–≥–æ –±–∞—Ç—á—É (100ms)
await new Promise(resolve => setTimeout(resolve, 100));
```

**–°—Ç–∞–ª–æ:**
```typescript
// –ü–∞—É–∑–∞ —Ç—ñ–ª—å–∫–∏ –∫–æ–∂–Ω—ñ 50 —á–∞–Ω–∫—ñ–≤ (50ms)
if (processedCount % 50 === 0) {
    await new Promise(resolve => setTimeout(resolve, 50));
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–µ–Ω—à–µ –ø–∞—É–∑ = —à–≤–∏–¥—à–µ –æ–±—Ä–æ–±–∫–∞

### ‚úÖ 3. –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è

**–ë—É–ª–æ:**
```typescript
console.log(`[Embeddings] –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è batch 1/15...`);
console.log(`[LocalEmbeddings] –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è 10 embeddings...`);
console.log(`[LocalEmbeddings] –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ 10 embeddings`);
```

**–°—Ç–∞–ª–æ:**
```typescript
console.log(`[Embeddings] Batch 1/8 (20 chunks)...`);
// –ú–µ–Ω—à–µ –∑–∞–π–≤–æ–≥–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–µ–Ω—à–µ I/O –æ–ø–µ—Ä–∞—Ü—ñ–π = —à–≤–∏–¥—à–µ

---

## üìä –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏

### –î–æ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:
```
150 chunks / 10 per batch = 15 batches
15 batches √ó 2 sec = ~30 —Å–µ–∫—É–Ω–¥
+ 15 √ó 100ms –ø–∞—É–∑–∏ = +1.5 —Å–µ–∫
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–í–°–¨–û–ì–û: ~31.5 —Å–µ–∫—É–Ω–¥
```

### –ü—ñ—Å–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:
```
150 chunks / 20 per batch = 8 batches  
8 batches √ó 2 sec = ~16 —Å–µ–∫—É–Ω–¥
+ 3 √ó 50ms –ø–∞—É–∑–∏ = +0.15 —Å–µ–∫
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–í–°–¨–û–ì–û: ~16-18 —Å–µ–∫—É–Ω–¥ ‚ö°
```

**–ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è: ~2x —à–≤–∏–¥—à–µ!**

---

## üß™ –Ø–∫ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏

–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ç–æ–π —Å–∞–º–∏–π PDF —Ñ–∞–π–ª —ñ –ø–æ—Ä—ñ–≤–Ω—è–π—Ç–µ —á–∞—Å:

**–î–æ:**
```
[Embeddings] Progress: 150/150 chunks processed
–ß–∞—Å: ~30-35 —Å–µ–∫—É–Ω–¥
```

**–ü—ñ—Å–ª—è:**
```
[Embeddings] Progress: 150/150 chunks processed  
–ß–∞—Å: ~15-20 —Å–µ–∫—É–Ω–¥ ‚ö°
```

---

## ‚öôÔ∏è –î–æ–¥–∞—Ç–∫–æ–≤—ñ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

### –Ø–∫—â–æ —Ö–æ—á–µ—Ç–µ —â–µ —à–≤–∏–¥—à–µ:

#### 1. –ó–±—ñ–ª—å—à–∏—Ç–∏ batch –¥–æ 30-50:
```typescript
const BATCH_SIZE = 30; // –©–µ —à–≤–∏–¥—à–µ, –∞–ª–µ –±—ñ–ª—å—à–µ RAM
```

**–ü–ª—é—Å–∏:** –®–≤–∏–¥—à–µ (10-12 —Å–µ–∫—É–Ω–¥)  
**–ú—ñ–Ω—É—Å–∏:** –ë—ñ–ª—å—à–µ RAM (~100-150 MB)

#### 2. –ó–º–µ–Ω—à–∏—Ç–∏ MAX_CHUNKS:
```typescript
const MAX_CHUNKS = 100; // –ó–∞–º—ñ—Å—Ç—å 150
```

**–ü–ª—é—Å–∏:** –®–≤–∏–¥—à–µ (10 —Å–µ–∫—É–Ω–¥)  
**–ú—ñ–Ω—É—Å–∏:** –ú–µ–Ω—à–µ –ø–æ–∫—Ä–∏—Ç—Ç—è —Ç–µ–∫—Å—Ç—É

#### 3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –º–µ–Ω—à—É –º–æ–¥–µ–ª—å:
```typescript
const MODEL_NAME = 'Xenova/all-MiniLM-L6-v2'; // –®–≤–∏–¥—à–∞, –∞–ª–µ —Ç—ñ–ª—å–∫–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫–∞
```

**–ü–ª—é—Å–∏:** 2-3x —à–≤–∏–¥—à–µ  
**–ú—ñ–Ω—É—Å–∏:** –ù–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î —É–∫—Ä–∞—ó–Ω—Å—å–∫—É

---

## üìà –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ

| –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è | –ß–∞—Å (150 chunks) | RAM | –Ø–∫—ñ—Å—Ç—å |
|--------------|------------------|-----|--------|
| **–ü–æ—Ç–æ—á–Ω–∞ (–æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞)** | **~16-18 —Å–µ–∫** | **~60 MB** | **‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê** |
| Batch 30 | ~12-14 —Å–µ–∫ | ~100 MB | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| MAX_CHUNKS 100 | ~10-12 —Å–µ–∫ | ~60 MB | ‚≠ê‚≠ê‚≠ê‚≠ê |
| –ú–µ–Ω—à–∞ –º–æ–¥–µ–ª—å | ~6-8 —Å–µ–∫ | ~40 MB | ‚≠ê‚≠ê‚≠ê‚≠ê (—Ç—ñ–ª—å–∫–∏ EN) |
| OpenAI API | ~15-20 —Å–µ–∫ | ~20 MB | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê ($$$) |

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

### –î–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ –≤–∏–ø–∞–¥–∫—ñ–≤:
‚úÖ **–ü–æ—Ç–æ—á–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è** (BATCH_SIZE=20) - –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π –±–∞–ª–∞–Ω—Å

### –Ø–∫—â–æ RAM –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞:
‚úÖ –ó–±—ñ–ª—å—à–∏—Ç–∏ –¥–æ BATCH_SIZE=30

### –Ø–∫—â–æ —Ç—ñ–ª—å–∫–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫–∞ –º–æ–≤–∞:
‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ all-MiniLM-L6-v2

### –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å:
‚úÖ –ó–º–µ–Ω—à–∏—Ç–∏ MAX_CHUNKS –¥–æ 100

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

Embeddings —Ç–µ–ø–µ—Ä –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è **–≤–¥–≤—ñ—á—ñ —à–≤–∏–¥—à–µ**:
- –ë—É–ª–æ: ~30-35 —Å–µ–∫—É–Ω–¥
- –°—Ç–∞–ª–æ: ~15-20 —Å–µ–∫—É–Ω–¥
- –ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è: **2x** ‚ö°

–Ü –≤—Å–µ —â–µ **–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ**! üéâ
